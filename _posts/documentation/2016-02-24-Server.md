---
layout       : feature-doc
title        : "Connecting"
date         : 2016-02-24 00:31:01 +0000
date_updated : 2016-01-24 00:31:02 +0000

f_image      : "/images/server-events@2x.png"
categories   : general
tax          : general
---
There connection process is simple and easy with minimal mark-up required in order to get the display and controller clients connected on the same channel via Cluster groups.
<!--more-->

Whence the you have installed the **cwc** node server, connecting client can be accomplished with minimal mark-up required. The the `cwc-display-master.js` and `cwc-controller-master.js` have built in actions for handling cline to server connection.

Both the `cwc-display-master.js` and `cwc-controller-master.js` have a built in server object this allows each client to connect to the cwc node server. The following parameters have to set when initiating the **cwc.Server** object on a client.

| Setting  | Type     | Vales                | cwc-display-master.js | cwc-controller-master.js |
| -------- | -------- | -------------------- | :-:                   | :-:                      |
| host     | Sting    | http://localhost.com | &#x2714;              | &#x2714;                 |
| port     | Int      | 5000                 | &#x2714;              | &#x2714;                 |
| type     | Sting    | 'ws'                 | &#x2714;              | &#x2714;                 |

#### JavaScript Declaration

{% highlight javascript linenos %}
/*------------------------------------------------------
* @object - CWC Main Server Object
* @info   - Establishing a connection to the server
*/
Server = new cwc.Server({
    host : 'http://localhost.com',
    port : 0000,
    type : 'ws'
});
{% endhighlight %}

>**Chameleon Web Controller** only has support for WebSocket, in near future we hope to releases support for other Node Sockets implementations.

## Connect method
Whence the `cwc.Server` object is initiated, calling the `connect` method on the object will allow the client to connect.

#### Display (cwc-display-master.js)
{% highlight javascript linenos %}
/*------------------------------------------------------
* @method - cwc.Server Connect method
* @info    - cwc-display-master.js
*/
Server.connect(
);
{% endhighlight %}

#### Controller (cwc-controller-master.js)
{% highlight javascript linenos %}
/*------------------------------------------------------
* @method - cwc.Server Connect method
* @info    - cwc-controller-master.js
*/
Server.connect(
  000000 // You must provide cluster code
);
{% endhighlight %}

>Only the cluster-code is required when trying to connect a controller as the `cluster-code` is auto generated by the `cwc-display-master.js`.

## Connection Hooks
Predefined hooks can be set up on both the display and controller allowing for callback functions to be invoke on the following requests.

| Hook name               | cwc-display-master.js | cwc-controller-master.js |
| ------------------      | :-:                   | :-:                      |
| connection-success      | &#x2714;              | &#x2714;                 |
| connection-failed       | &#x2714;              | &#x2714;                 |
| controller-connected    | &#x2714;              | &#x2718;                 |
| controller-disconnected | &#x2714;              | &#x2718;                 |

## On connection success hook
The `connection-success` hook is called when a client has successfully completed the WebSockets upgrade request with the server.

| Hook name          | Type    | Invoked by server                                         |
| ------------------ | --      | --------------------------------------------------------- |
| connection-success | Hook    | Called when the client has successfuly connected          |

{% highlight javascript linenos %}
/* -- Create connection success | Hook -- */
Hooks.set_hook( {
  hook_name : 'cwc:connection-success',
  method    : function( feedback ) { on_connect( feedback ) }
} );
{% endhighlight %}

## On connection failed hook
The `connection-success` hook is called when a client has successfully completed the WebSockets upgrade request with the server.

| Hook name          | Type | Invoked by server                                         |
| ------------------ | --   | --------------------------------------------------------- |
| connection-failed  | Hook | Called when the client's has failed to connect            |

{% highlight javascript linenos %}
/* -- Create connection failed | Hook -- */
Hooks.set_hook( {
  hook_name : 'cwc:connection-failed',
  method    : function( feedback ) { console.log( data ); }
} );
{% endhighlight %}

## Controller connected hook
Hooks can also be set to run a function for when a controller has connected to the display client. In order to activate the hook, set a `controller-connected` hook. This hook can only be set on clients using the **cwc-controller-master.js** file.

| Hook name            | Type | Invoked by server                                         |
| ------------------   | --   | --------------------------------------------------------- |
| controller-connected | Hook | Called when the client has connected to the display       |

{% highlight javascript linenos %}
/* -- Create controller connected | Hook -- */
Hooks.set_hook( {
  hook_name : 'controller-connected',
  method    : function( controller ) { controller_connected( controller ) }
} );
{% endhighlight %}

## Controller disconnected hook
Just like the `controller-connected` hook, a hook can be set so that you can capture when a controller client disconnects from the display. In order to set this, use the `controller-disconnected` hook with a specified callback method. Also like the the `controller-connected` hook, this too can only be set using the **cwc-controller-master.js**.

| Hook name               | Type | Invoked by server                                         |
| ------------------      | --   | --------------------------------------------------------- |
| controller-disconnected | Hook | Called when the client has disconnected from the display  |

{% highlight javascript linenos %}
/* -- Create  controller disconnected | Hook -- */
Hooks.set_hook( {
  hook_name : 'controller-disconnected',
  method    : function( controller ) { controller_disconnected( controller ) }
} );
{% endhighlight %}

## Feedback information
`connection-success`, `connection-failed`, `controller-connected` and `controller-disconnected` all receive feedback information when called by the server. The table below outlines the information sent by the server. On `controller-connected` and `controller-disconnected` passes the information about the controllers connected to the display.

| Keys          | Type      | Description                                               |
| ------------- | ------    | --------------------------------------------------------- |
| client_type   | String    | The type of client `display` or `Controller`              |
| cluster_code  | Int       | The cluster code of the group connected to                |
| key           | Sting     | the key given to the client by the server                 |
| timestamp     | Timestamp | The time (in milliseconds) the connection was established |

>When trying to access this information from the `controller-connected` and `controller-disconnected` events, information is presented in an `array` format.

## Demos

### Looping through connected controllers
The snippet below can be used with both the `controller-connected` and `controller-disconnected` events to retrieve all controllerâ€™s information whom are connected to the display.

#### Display client
{% highlight javascript linenos %}
/*------------------------------------------------------
* @object - CWC Main Server Object
* @info   - initiate CWC Server Object
*/
var Server = new cwc.Server({
    host : 'http://localhost.com',
    port : 0000,
    type : 'ws'
});

/*------------------------------------------------------
* @object - CWC Main Hooks Object
* @info   - initiate CWC Hooks Object
*/
var Hooks = new cwc.Hooks({
});

/* -- Create controller connected | Hook -- */
Hooks.set_hook( {
  hook_name : 'controller-connected',
  method    : function( controllers ) { controllers_loop( controllers ) }
} );

/* -- Create controller disconnected | Hook -- */
Hooks.set_hook( {
  hook_name : 'controller-disconnected',
  method    : function( controllers ) { controllers_loop( controllers ) }
} );

/*------------------------------------------------------
* @method - cwc.Server Connect method
* @info    - cwc-display-master.js
* @info    - Hooks must be created before connecting
*/
Server.connect(
);

/*------------------------------------------------------
* @function - Controllers loop
* @info     - Callback function for controller-connected && controller-disconnected
*/
function controllers_loop( controllers )
{
    for( var i = 0; i < controllers.length; i++ )
    {
        var controller = controllers[ i ];
        console.log( controller );
    }
};
{% endhighlight %}